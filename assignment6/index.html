<html>
 <!-- MoSIS Assignments template -->

 <title>MoSIS Assignment 6</title>

 <p bgcolor="#ffffff">

 <hr noshade>

   <h1>MoSIS Assignment 6</h1>

    <h2>Team</h2>
     <pre>
      Name       :	DaniÃ«lle Jongstra
      Student ID :	20172260
      e-mail     :	Danielle.jongstra@student.uantwerpen.be

      Name       :	Joanna Kisaakye
      Student ID :	20205490
      e-mail     :	joanna.kisaakye@student.uantwerpen.be

      Time spent on this assignment (in hours): hours
     </pre>

 
 <h2>Requirements : </h2>
 <p>
 On top of the requirements listed as part of the assignment description, we had the following requirements:
 <ol>
	 <li>
		 Each machine maintains state that describes the current situation within the machine.
	 </li>
	 <li>
		 There are 4 hierarchical types of machines:
		 <ol>
			 <li> the type that produces raw materials such as the Cube and the Cylinder</li>
			 <li> the type that processes inputs one at a time and has a queue</li>
			 <li> the type that assembles raw materials into a new output</li>
			 <li> the type that collects items, which may either pass them onto the next machine or not.</li>
		 </ol>
	 </li>
	 <li>
		 There are two types of raw materials, the Cube and the Cylinder.
	 </li>
	 <li>
		 The state of a product is stored within the product, and is updated during processing. It includes:
		 <ol>
			 <li>
				 The creation time.
			 </li>
			 <li>
				 The time it enters a queue.
			 </li>
			 <li>
				 The start time of a process on the product.
			 </li>
			 <li>
				 The correctness of the product.
			 </li>
			 <li>
				 The number of times the product has been reassembled.
			 </li>
		 </ol>
	 </li>
	 <li>
		 There is a separate object required to collect statistical data about the whole model.
	 </li>
 </ol>
 </p>
 <h2>Assumptions : </h2>
 <p>
 The assumption made in our models include:
 <ol>
	 <li>
		 Machines never power on or off, they are either in an idle state or processing state.
	 </li>
	 <li>
		The correctness value of a product determines whether the product is accepted, trashed or sent to be fixed.
	 </li>
 </ol>
 </p>
 <h2>Design : </h2>
 <figure>
	 <img src="./img/DEVS Model Design.jpg">
	 <figcaption>Figure 1: Class Diagram Summarising DEVS model design</figcaption>
 </figure>
 <h4>DEVS models</h4>
 <p>
 Our design consists of 5 atomic DEVS models and one Coupled DEVS model that include:
 <ol>
	 <li>
		 The <b>ObjectSource</b> model:
		 <br>
		 This model produces the <i>"Cube"</i> and <i>"Cylinder"</i> raw materials required to assemble a product, it only has one output port.
	 </li>
	 <li>
		 The <b>Operator</b> model:
		 <br>
		 This model processes a Product at a time, it has a queue, mean standard deviation, and a seed . It has two sub models:
		 <ol>
			 <li>
				 The <b>Assembler</b>:
				 Has one output port for assembled products.
			 </li>
			 <li>
				 The <b>Inspector</b>:
				 Has 3 different output ports that for accepted products, rejected products and products that will have to be fixed/reassembled.<br>
				 To determine these, the assembler also has 3 "part" attributes that hold the ratios to be used to determine where to send products.
			 </li>
		 </ol>
	 </li>
	 <li>
		 The <b>Preassembler</b> model:
		 <br>
		 This model produces a product after it has acquired enough <i>"Cubes"</i> and <i>"Cylinders"</i>. The Preassembler has one input port <i>"in_object"</i> to which both object sources are connected.
	 </li>
	 <li>
		 The <b>FATmachine</b> model:
		 <br>
		 This model collects assembled products and keeps the count of total products collected and total products collected that were reassembled as part of its state. This model has 3 sub models:
		 <ol>
			 <li>
				 The <b>Fix</b>:
				 Has one output port so that it can pass on assembled products to be reassembled.
			 </li>
			 <li>
				 The <b>Accept</b>:
				 Collects assembled items and keeps track of reassembled items that have been accepted as well as all accepted items.
			 </li>
			 <li>
				 The <b>Trash</b>:
				 Collects assembled items and keeps track of all rejected items.
			 </li>
		 </ol>
	 </li>
	 <li>
		 The <b>Statistics</b> model:
		 <br>
		 This model keeps track of the global state of the System coupled DEVS model. It has two input ports <i>"in_queuetimes"</i> and <i>"in_product"</i>. The <i>"waitingTimes"</i> attribute collects the times spent by products in the queues of the inspector and assembler.<br>
		 The <i>"totalTimes"</i> list keeps track of the total time each product has spent in the system from the point of assembly.
		 <br>
		 The <i>"getAverageTotalTime"</i> function returns the mean of the total times. The <i>"getAverageWaitingTime"</i> function returns the mean of the waiting times.
	 </li>
	 <li>
		 The <b>Factory</b> model:
		 <br>
		 This is the CoupledDEVS model that brings all the atomic models together.
	 </li>
 </ol>
 Each of the models is composed of a separate <i>"State"</i> object that contains data about the current situation within the machine, such as the current time, the remaining time, the current product, the number of items in the queue, the queue, waiting times and so on. This allows us to separate the current state of the model from it's behaviour and it also allows us to easily collect analytical data.
 <br>
 Each of the models above, apart from the ObjectSource model, also interacts with a <b>Product</b> object in one way or the other.

 <h4>Product</h4>
 	The product class represents the actual products assembled by the system. Each product also tracks it's creation time, it's arrival time at a process, time it has spent in a queue, the number of times it has been reassembled and it's correctness measure.
 </p>
 <h2>Implementation : </h2>
 <p>Our solution is implemented in PythonPDEVS, the detailed description of the model files is below:</p>
 <h4><a href="./FATMachines.py">FATMachines.py</a></h4>
 <p>
	 This file contains the definition of the FATmachines atomic DEVS model, its 3 sub models, <b>Accept</b>, <b>Fix</b> and <b>Trash</b> as well as the definition of its <b>State</b>.
	 <br>
	 The attributes of the <b>State</b> include:
	 <ol>
		 <li>
			 active : a boolean specifying whether this machine is working at the moment. The time advance function uses this boolean to determine the time to return.
		 </li>
		 <li>
			 current: the current product being worked on
		 </li>
		 <li>
			 total: the total number of products received by this machine, not set for fix.
		 </li>
		 <li>
			 reassembled: the total number of products received by this machine that were reassembled, only used for accept.
		 </li>
	 </ol>
	 <br>
	 The internal transition function marks the FATmachine model as inactive. The external transition function marks the model as active and makes the incoming product the current product.
	 <br>The output function simply returns the current product, so that the product can be used by the next DEVS.
	 <br> <br>
	 The three sub models each have their own external transition function that call the superclass its external transition function. In this sub function the class specific parameters that do not have to do with sending the product to output are set.
	 <ul>
		<li>
		Fix: Increase the amount of times the product has been reassembled with 1.
		</li>
		<li>
		Accept: add 1 to the the total amount of products that have been accepted. Also check if it has been reassembled and add 1 to total amount of products reassembled for this class.
		</li>
		<li>
		Trash: add 1 to the the total amount of products that have been trashed.
		</li>
	 
	 </ul>
 </p>


 <h4><a href="./ObjectSource.py">ObjectSource.py</a></h4>
 <p>
	 This file contains the definition of the ObjectSource atomic DEVS model. It is a very simple model which has one output port and one other attribute which is the time.
	 <br>
	 <ol>
		 <li>
			 time: This is a Float that indicates how long this source takes to produce a raw material item. It is the time returned by the time advance function.
		 </li>
	 </ol>
	 <br>The output function simply returns the model name, which represents the raw material being produced by the machine. The initialization function set the appropriate name and time for different sources.
	 These values are given in the coupled DEVS "system".
 </p>

 <h4><a href="./Operator.py">Operator.py</a></h4>
 <p>
	 This file contains the definition of the Operator atomic DEVS model, its 2 sub models, <b>Assembler</b> and <b>Inspector</b> as well as the definition of its <b>State</b>.
	 <br>
	 The attributes of the <b>OperatorState</b> include:
	 <ol>
		 <li>
			 queue : an list that holds received products.
		 </li>
		 <li>
			 currentTime: the current simulated time of this model.
		 </li>
		 <li>
			 remainingTime: the time remaining for the operator to finish the current product.
		 </li>
		 <li>
			 productProcessing: the current product being worked on.
		 </li>
	 </ol>
	 <br>
	 In addition to the state, the other attributes of the <b>Operator</b> include:
	 <ol>
		 <li>
			 mean : the mean to be used when generating ransom numbers.
		 </li>
		 <li>
			 standardDeviation: the standard Deviation to be used when generating random numbers.
		 </li>
		 <li>
			 seed: the seed for the random number generators.
		 </li>
		 <li>
			 in_product: the input port.
		 </li>
		 <li>
			 out_stats: the output port for the statistics, used to pass the time a product waited in the queue to the statistics DEVS.
		 </li>
	 </ol>
     <br>
	 The Operator model essentially overrides the following functions of the AtomicDEVS model:
	 <ol>
		 <li>
			 extTransition : Upon receipt of an item, the external transition function updates the currentTime with the elapsed time. This value is then set in the product as its queue time and the product is appended to the queue.
			 <br>If the remaining time is INFINITY i.e. the machine is idle, the product is allowed to enter the machine for processing via the enterOperator() function.
			 <br>Otherwise, the remaining time is reduced by the elapsed time.
		 </li>
		 <li>
			 intTransition: This function removes an item from the queue, if there are no more items in the queue, then the machine is marked as idle.
			 <br>If that is not the case, another product is allowed in for processing by using the enterOperator() function.
		 </li>
		 <li>
			 timeAdvance: returns the remaining time, if the remaining time is less than 0, it returns zero.
		 </li>
	 </ol>
 <br>
 The <b>enterOperator</b> function is responsible for setting the time that this machine is going to take to process an item, based on the mean and standard deviation provided at the point of instantiation.
 <br>It also sets the entry time of the product as the the machines current simulated time and sets the product as the current product processing.
 </p>

 <h5>The Assembler</h5>
 <p>
	 The main feature of the Assembler is that it has one extra output port for the products assembled and the following functions are overridden:
     <ol>
		 <li>
			 outputFnc : Both the time spent in the queue of the product and the product itself are outputs, albeit to different destinations.
		 </li>
		 <li>
			 extTransition: Upon receipt of a product, the assembler sets its correctness before letting its parent function proceed.
		 </li>
	 </ol>
 </p>

 <h5>The Inspector</h5>
 <p>
	 The main feature of the Inspector is that it has 3 additional attributes that specify the cutoff ratios of correctness and three outputs. The trashPart and the fixPart are inputs to the constructor. The acceptPart however is calculated using the other part to ensure the sums do not exceed 1.
	 <br>The following functions are also overridden:
     <ol>
		 <li>
			 outputFnc : Both the time spent in the queue of the product and the product itself are outputs, albeit to different destinations. The timeInQueue is sent to the <b>Statistics</b> model but the product is sent to it's next destination according to it's correctness.
			 <br>the products destination depends on where the correctness lies in the range of the trashPart, fixPart and acceptPart.
		 </li>
	 </ol>
 </p>

 <h4><a href="./Preassembler.py">Preassembler.py</a></h4>
 <p>
	 This file contains the definition of the Preassembler atomic DEVS model and the definition of its <b>State</b>.
	 <br>
	 The attributes of the <b>PreassemblerState</b> include:
	 <ol>
		 <li>
			 cylinders : a counter for cylinders received.
		 </li>
		 <li>
			 cubes: a counter for cubes received.
		 </li>
		 <li>
			 time: the current time of the model used to set the creation time of a product.
		 </li>
	 </ol>
	 <br>
	 In addition to the state, the other attributes of the <b>Preassembler</b> include:
	 <ol>
		 <li>
			 in_object : the input port.
		 </li>
		 <li>
			 out_product: the output port.
		 </li>
	 </ol>
     <br>
	 The Operator model overrides the following functions of the AtomicDEVS model:
	 <ol>
		 <li>
			 extTransition : Updates the current simulated time of the machine to the elapsed time and increments the counters according to the type of the input.
		 </li>
		 <li>
			 intTransition: Reduces the cube and cylinder counters by the amount needed of each to create a product.
		 </li>
		 <li>
			 timeAdvance: marks the machine as idle unless the required number of cubes and cylinders have been received at which point the time advance returns 0(an immediate transition).
		 </li>
		 <li>
			 outputFnc: returns an assembled product with the creation time set to the current time.
		 </li>
	 </ol>

 <h4><a href="./Statistics.py">Statistics.py</a></h4>
 <p>
	 This file contains the definition of the Statistics atomic DEVS model and the definition of its <b>State</b>.
	 <br>
	 The attributes of the <b>StatisticState</b> include:
	 <ol>
		 <li>
			 currentTime : the current simulated time of the entire system.
		 </li>
		 <li>
			 waitingTimes: an list of waiting times spent in the system by any product.
		 </li>
		 <li>
			 totalProducts: the product counter.
		 </li>
		 <li>
			 amountReassembled: the dictionary of reassembled products, keeping a counter of how many products have been reassembled a certain amount of times before being accepted or trashed.
		 </li>
		 <li>
			 totalTimes: the list of total times spent in the system by each product.
		 </li>
	 </ol>
	 <br>
	 In addition to the state, the other attributes of the <b>Statistics</b> include:
	 <ol>
		 <li>
			 in_queueTimes : the input port for product queue times.
		 </li>
		 <li>
			 in_product: the input port for products.
		 </li>
	 </ol>
     <br>
	 The Statistics model overrides the following functions of the AtomicDEVS model:
	 <ol>
		 <li>
			 extTransition : Upon receipt of inputs, the current time is updated with the elapsed time.
			 <br>A received queue time is added to the list of waiting times.
			 <br>When a product is received, the total number of products is incremented, the total time spent by the product in the system is calculated and added to the total times list.
			 <br>The amount of times this product has been reassembled is retrieved and if the that digit is already part of the dictionary, it's number is incremented. Otherwise a new entry is added for that digit with a value of 1.
		 </li>
	 </ol>
     <br>
	 The Statistics model provides the following helper functions, which is used mainly for reporting:
	 <ol>
		 <li>
			 getTime: Return the current simulated time.
		 </li>
		 <li>
			 getAverageWaitingTime: Returns the average waiting time.
		 </li>
		 <li>
			 getTotalProducts: Returns the total number of products assembled.
		 </li>
		 <li>
			 getReassemblies: Returns the total number of reassemblies observed in the form <i>{ number_of_reassemblies:number_of_products }</i>.
		 </li>
		 <li>
			 getAverageTotalTime: Returns the average time spent in the system by a product.
		 </li>
	 </ol>

 <h4><a href="./System.py">System.py</a></h4>
 <p>
	 This file contains the definition of the Factory coupled DEVS model.
     <br>
	 The Factory model provides the following helper functions, for use mainly for reporting:
	 <ol>
		 <li>
			 printStatistics: Writes out the statitics collected by the Statistics atomic model to a file.
		 </li>
	 </ol>
	 <br> 
	 The factory initializes the different models and connects the appropriate models.

 <h4><a href="./Product.py">Product.py</a></h4>
 <p>
	 This file contains the definition of the Product object processed by the system.
     <br>
	 The Product model provides the following helper functions, for use mainly for tracking its state:
	 <ol>
		 <li>
			 getCreationTime: Returns the time when it was created.
		 </li>
		 <li>
			 setEntryTime: Sets the time that it is admitted into a machine for processing.
		 </li>
		 <li>
			 setQueueTime: Sets the time spent in a queue.
		 </li>
		 <li>
			 getTimeInQueue: Returns the time spent in a queue.
		 </li>
		 <li>
			 getCorrectness: Returns the correctness measure.
		 </li>
		 <li>
			 setNewCorrectness: Calculates the new correctness measure based on the previous measure.
		 </li>
		 <li>
			 getAmountReas: Returns the count of reassemblies performed on this product.
		 </li>
		 <li>
			 increaseReas: Increases the count of reassemblies performed on this product by one.
		 </li>
	 </ol>

  <h4><a href="./Simulator.py">Simulator.py</a></h4>
 <p>
	 This file contains the simulation of the Factory coupled DEVS model.
 <br>

 <h2>Modelling and Simulation Results : </h2>

 <p>
    As can be seen from our simulation results in the following files, the percentage of items in the trash and the percentage of assembled items always add up to 100%:
    <ol>
        <li>
            <a href="./statsOriginal.txt">statsOriginal</a>
        </li>
        <li>
            <a href="./statsOtherInspector.txt">statsOtherInspector</a>
        </li>
        <li>
            <a href="./statsOtherSeed.txt">statsOtherSeed</a>
        </li>
        <li>
            <a href="AAAtemp/statsDeterministic.txt">statsDeterministic</a>
        </li>
    </ol>
</p>
<p>
    Our simulation cuts off at 2000ms, this can be observed in the two output files:
    <ol>
        <li>
            <a href="./SimulationOutput.txt">SimulationOutput.txt</a>
        </li>
        <li>
            <a href="AAAtemp/SimulationOutput.txt">deterministicDEV/SimulationOutput.txt</a>
        </li>
    </ol>

<h4><a href="./statsOriginal.txt">The original configuration(statsOriginal)</a></h4>
<p>
    In this simulation, 325 products were created. Most of them were accepted the first time and approximately 19.7% of them required reassembly.
    <br>
    The average queue time was over an hour, 74.1 minutes, and the average time in the system was over 5.63 hours. This could be an indication that the system is too slow.
    <br>
    There are very few edge cases when a product had to be reassembled 3 or more times, only 10% of the reassemblies.
</p>

<h4><a href="./statsOtherSeed.txt">Change of Seed configuration(statsOtherSeed)</a></h4>
<p>
    When we changed the seed, roughly the same number of products was produced in the same amount of time(there was only a small increment). Most of them were accepted the first time and approximately 20.1% of them required reassembly.
    <br>
    The average queue time is approximately the same, 74.1 minutes, and the average time spent by products in the system was still over 5.7 hours.
    <br>This was an considerable decrease in performance.
    <br>
    There are more edge cases when a product had to be reassembled 3 or more times, 15% of the reassemblies.
</p>

<h4><a href="./statsOtherInspector.txt">Inspector Change configuration(statsOtherInspector)</a></h4>
<p>
    When we changed the inspector, more products were produced in the same amount of time(there was a more considerable increment). More of them were accepted the first time, 89.6%, only in 10.35% in the trash.
    <br>
    Approximately 13% of them required reassembly.
    <br>
    The average queue time greatly reduced, 48.7 minutes, and the average time spent by products in the system dropped to just 3.5 hours.
    <br>This showed much better performance.
    <br>
    There are far fewer edge cases when a product had to be reassembled 3 or more times, only 3% of the reassemblies.
    <br>
    In conclusion, this configuration exhibited much better performance overall than the last two.

<h4><a href="AAAtemp/statsDeterministic.txt">Deterministic configuration(statsDeterministic)</a></h4>
<p>
</p>

 <hr noshade>

 </body>
</html>